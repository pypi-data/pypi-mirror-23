
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Using HTTP &#8212; pylm 0.14.3 documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.14.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Turning a PALM master into a microservice" href="microservice.html" />
    <link rel="prev" title="Building components from separate parts" href="parts.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="microservice.html" title="Turning a PALM master into a microservice"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="parts.html" title="Building components from separate parts"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pylm 0.14.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="low-level.html" accesskey="U">Low level API</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="parts.html"
                        title="previous chapter">Building components from separate parts</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="microservice.html"
                        title="next chapter">Turning a PALM master into a microservice</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/http.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-http">
<h1>Using HTTP<a class="headerlink" href="#using-http" title="Permalink to this headline">¶</a></h1>
<p>The default transport to connect the different parts of PALM is ZeroMQ over
tcp. Some organizations may not find that suitable for all cases. For
instance, it may be necessary to secure servers with encrypted connections,
or some servers may have to run behind traffic-sniffing firewalls, or you
want to exploit a server-less architecture for the workers… You name it.</p>
<p>For this reason, pylm includes two parts to communicate with workers with the
HTTP protocol to create a pipeline with that combines ZMQ sockets over TCP
and HTTP.</p>
<div class="figure align-center">
<img alt="_images/http_part.png" src="_images/http_part.png" />
</div>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pylm.parts.servers</span> <span class="kn">import</span> <span class="n">ServerTemplate</span>
<span class="kn">from</span> <span class="nn">pylm.parts.services</span> <span class="kn">import</span> <span class="n">PullService</span><span class="p">,</span> <span class="n">PubService</span><span class="p">,</span> <span class="n">CacheService</span>
<span class="kn">from</span> <span class="nn">pylm.parts.connections</span> <span class="kn">import</span> <span class="n">HttpConnection</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">ServerTemplate</span><span class="p">()</span>

<span class="n">db_address</span> <span class="o">=</span> <span class="s1">&#39;tcp://127.0.0.1:5559&#39;</span>
<span class="n">pull_address</span> <span class="o">=</span> <span class="s1">&#39;tcp://127.0.0.1:5555&#39;</span>
<span class="n">pub_address</span> <span class="o">=</span> <span class="s1">&#39;tcp://127.0.0.1:5556&#39;</span>

<span class="n">server</span><span class="o">.</span><span class="n">register_inbound</span><span class="p">(</span><span class="n">PullService</span><span class="p">,</span> <span class="s1">&#39;Pull&#39;</span><span class="p">,</span> <span class="n">pull_address</span><span class="p">,</span>
                        <span class="n">route</span><span class="o">=</span><span class="s1">&#39;HttpConnection&#39;</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">register_outbound</span><span class="p">(</span><span class="n">HttpConnection</span><span class="p">,</span> <span class="s1">&#39;HttpConnection&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;http://localhost:8888&#39;</span><span class="p">,</span> <span class="n">route</span><span class="o">=</span><span class="s1">&#39;Pub&#39;</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">register_outbound</span><span class="p">(</span><span class="n">PubService</span><span class="p">,</span> <span class="s1">&#39;Pub&#39;</span><span class="p">,</span> <span class="n">pub_address</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">register_bypass</span><span class="p">(</span><span class="n">CacheService</span><span class="p">,</span> <span class="s1">&#39;Cache&#39;</span><span class="p">,</span> <span class="n">db_address</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">preset_cache</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;server&#39;</span><span class="p">,</span>
                    <span class="n">db_address</span><span class="o">=</span><span class="n">db_address</span><span class="p">,</span>
                    <span class="n">pull_address</span><span class="o">=</span><span class="n">pull_address</span><span class="p">,</span>
                    <span class="n">pub_address</span><span class="o">=</span><span class="n">pub_address</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>Pylm provides a way to implement a worker in a very similar fashion to the
previous workers that were shown, and to obtain a WSGI application from it.
If you are not familiar with WSGI, it is a standarised way in which Python
applications are able to talk with web servers.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pylm.remote.server</span> <span class="kn">import</span> <span class="n">RequestHandler</span><span class="p">,</span> <span class="n">DebugServer</span><span class="p">,</span> <span class="n">WSGIApplication</span>


<span class="k">class</span> <span class="nc">MyHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">payload</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39; processed online&#39;</span>
    
<span class="n">app</span> <span class="o">=</span> <span class="n">WSGIApplication</span><span class="p">(</span><span class="n">MyHandler</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">DebugServer</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">8888</span><span class="p">,</span> <span class="n">MyHandler</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pylm.clients</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">repeat</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="s1">&#39;server&#39;</span><span class="p">,</span> <span class="s1">&#39;tcp://127.0.0.1:5559&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">job</span><span class="p">(</span><span class="s1">&#39;server.foo&#39;</span><span class="p">,</span> <span class="n">repeat</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;a message&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">messages</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Since the worker is now a WSGI application, you can run it with the web
server of your choice.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>$&gt; gunicorn -w 4 -b 127.0.0.1:8888 web_worker:app
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="microservice.html" title="Turning a PALM master into a microservice"
             >next</a> |</li>
        <li class="right" >
          <a href="parts.html" title="Building components from separate parts"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pylm 0.14.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="low-level.html" >Low level API</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015-2016, Guillem Borrell &amp; NFQ Solutions.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>