<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>rdopkg-adv-requirements(7)</title>
<style>

</style>
</head>
<body class="manpage">
<div id="header">
<h1>rdopkg-adv-requirements(7) Manual Page</h1>
<h2>NAME</h2>
<div class="sectionbody">
<p>rdopkg-adv-requirements - rdopkg adventures: requirements management</p>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_synopsis">SYNOPSIS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a story about managing requirements of an RDO package using <code>rdopkg</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prologue">PROLOGUE</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>rdopkg</code> contains actions to help you with requirements management, namely:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rdopkg reqdiff</code> shows diff of requirements.txt between versions</p>
</li>
<li>
<p><code>rdopkg reqcheck</code> compares <code>requirements.txt</code> with <code>.spec</code> Requires</p>
</li>
<li>
<p><code>rdopkg query</code> queries RDO repos for version of a supplied package</p>
</li>
<li>
<p><code>rdopkg reqquery</code> queries RDO repos for versions of <code>requirements.txt</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This docuemnt will give you some examples of how to use these commands.</p>
</div>
<div class="paragraph">
<p>Please make sure you have the latest <code>rdopkg</code>, at least <strong>0.28</strong>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s explore <code>python-openstackclient</code> RDO package. All commands are run in
its distgit with <code>patches</code> and <code>upstream</code> remotes set up:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cd python-openstackclient
$ git fetch --all
$ git remote -v
openstack    git@github.com:openstack/python-openstackclient.git (fetch)
openstack    git@github.com:openstack/python-openstackclient.git (push)
origin    ssh://jruzicka@pkgs.fedoraproject.org/python-openstackclient (fetch)
origin    ssh://jruzicka@pkgs.fedoraproject.org/python-openstackclient (push)
patches    git@github.com:redhat-openstack/python-openstackclient.git (fetch)
patches    git@github.com:redhat-openstack/python-openstackclient.git (push)</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s assume we see the package for the first time and we want to check
whether its requirements are met.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ rdopkg pkgenv
Package:  python-openstackclient
Version:  1.0.3
Upstream: 1.1.0
OS dist:  RDO

Dist-git branch:        master
Local patches branch:   master-patches
Remote patches branch:  patches/master-patches
Remote upstream branch: openstack/master

RDO release/dist guess: kilo/f22</pre>
</div>
</div>
<div class="paragraph">
<p>Now we know that</p>
</div>
<div class="ulist">
<ul>
<li>
<p>package is at version <code>1.0.3</code> while upstream is at <code>1.1.0</code></p>
</li>
<li>
<p><code>rdopkg</code> was able to detect the upstream remote/branch (automagic works)</p>
</li>
<li>
<p><code>master</code> branch currently corresponds to Kilo release (see <code>rdopkg info</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>so we can start inspecting the requirements.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapter_1">CHAPTER 1</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>rdopkg reqdiff</strong></p>
</div>
<div class="paragraph">
<p><code>reqdiff</code> shows a human friendly summary of changes to <code>requirements.txt</code> file
between two git refs (usually version tags).</p>
</div>
<div class="paragraph">
<p>When <code>patches</code> and <code>upstream</code> remotes are set correctly, the action can be run
without arguments and <code>rdopkg</code> will do a diff between current and latest
upstream versions:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ rdopkg reqdiff
requirements.txt diff between 1.0.3 and 1.1.0:

ADDED:
  os-client-config

CHANGED:
  cliff &gt;=1.10.0  (was &gt;=1.7.0)
  oslo.config &gt;=1.9.3  (was &gt;=1.9.0)
  oslo.i18n &gt;=1.5.0  (was &gt;=1.3.0)
  oslo.serialization &gt;=1.4.0  (was &gt;=1.2.0)
  oslo.utils &gt;=1.4.0  (was &gt;=1.2.0)
  python-novaclient &gt;=2.22.0  (was &gt;=2.18.0,!=2.21.0)
  stevedore &gt;=1.3.0  (was &gt;=1.1.0)</pre>
</div>
</div>
<div class="paragraph">
<p>With one argument, diff between current package version and supplied git ref
is done:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ rdopkg reqdiff 1.1.0
requirements.txt diff between 1.0.3 and 1.1.0:
...</pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we can supply two git refs to get <code>requirements.txt</code> diff
between them:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ rdopkg reqdiff 0.4.0 1.0.0
requirements.txt diff between 0.4.0 and 1.0.0:

ADDED:
  Babel &gt;=1.3
  cliff-tablib &gt;=1.0
  oslo.i18n &gt;=1.0.0
  oslo.serialization &gt;=1.0.0
  oslo.utils &gt;=1.0.0
  python-neutronclient &gt;=2.3.6,&lt;3
  stevedore &gt;=1.1.0

CHANGED:
  cliff &gt;=1.7.0  (was &gt;=1.4.3)
  python-cinderclient &gt;=1.1.0  (was &gt;=1.0.6)
  python-glanceclient &gt;=0.14.0  (was &gt;=0.9.0)
  python-keystoneclient &gt;=0.11.1  (was &gt;=0.9.0)
  python-novaclient &gt;=2.18.0  (was &gt;=2.17.0)
  requests &gt;=2.2.0,!=2.4.0  (was &gt;=1.1)

REMOVED:
  keyring &gt;=2.1
  pycrypto &gt;=2.6</pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>reqdiff</code> is automatically shown during <code>rdopkg new-version</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapter_2">CHAPTER 2</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>rdopkg reqcheck</strong></p>
</div>
<div class="paragraph">
<p><code>reqcheck</code> is used to check whether requires defined in <code>requirements.txt</code> are
met in the <code>.spec</code> file. Human friendly summary is printed.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ rdopkg reqcheck

VERSION NOT ENFORCED:
  python-babel &gt;=1.3
  python-cliff &gt;=1.7.0
  python-oslo-i18n &gt;=1.3.0
  python-oslo-serialization &gt;=1.2.0
  python-oslo-utils &gt;=1.2.0
  python-pbr &gt;=0.6,!=0.7,&lt;1.0
  python-cinderclient &gt;=1.1.0
  python-glanceclient &gt;=0.15.0
  python-keystoneclient &gt;=1.1.0
  python-neutronclient &gt;=2.3.11,&lt;3
  python-novaclient &gt;=2.18.0,!=2.21.0
  python-requests &gt;=2.2.0,!=2.4.0
  python-six &gt;=1.9.0
  python-stevedore &gt;=1.1.0

MISSING:
  python-cliff-tablib &gt;=1.0
  python-oslo-config &gt;=1.9.0</pre>
</div>
</div>
<div class="paragraph">
<p>Human brain superpowers are used to evaluate the report and fix the <code>.spec</code>
file if needed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapter_3">CHAPTER 3</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>rdopkg query</strong></p>
</div>
<div class="paragraph">
<p>Is package X available in RDO? At which version? <code>rdopkg query</code> was created to
answer these recurring questions.</p>
</div>
<div class="paragraph">
<p>We can query a specific release/dist:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ rdopkg query kilo/f22 python-novaclient
kilo/f22
    python-novaclient-2.23.0-1.fc23  @  RDO Kilo f22
    python-novaclient-2.20.0-1.fc22  @  Fedora 22</pre>
</div>
</div>
<div class="paragraph">
<p>We now see that <code>python-novaclient-2.20.0-1</code> is present in base Fedora 22 repo
but newer <code>python-novaclient-2.23.0-1</code> is available from RDO Kilo f22 repo.</p>
</div>
<div class="paragraph">
<p>We can also query a package across all dists of an RDO release. We might
want to use <code>-v</code>/<code>--verbose</code> to see what&#8217;s happening in the background:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ rdopkg query -v kilo python-novaclient

repoquery --nvr --repofrompath=rdopkg_RDO_Kilo_f22,...
RDO Kilo f22: python-novaclient-2.23.0-1.fc23
repoquery --nvr --repofrompath=rdopkg_Fedora_22_Updates,...
...

kilo/f22
    python-novaclient-2.23.0-1.fc23  @  RDO Kilo f22
    python-novaclient-2.20.0-1.fc22  @  Fedora 22
kilo/f21
    python-novaclient-2.23.0-1.fc23  @  RDO Kilo f21
    python-novaclient-2.17.0-3.fc21  @  Fedora 21
kilo/el7
    python-novaclient-2.23.0-1.el7  @  RDO Kilo el7</pre>
</div>
</div>
<div class="paragraph">
<p>See <code>rdopkg info</code> to get supported release/dist combinations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chapter_4">CHAPTER 4</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>rdopkg reqquery</strong></p>
</div>
<div class="paragraph">
<p><code>reqquery</code> queries versions of <code>requirements.txt</code> or <code>.spec</code> Requires in RDO
repos and provides colorful report to easily check whether dependencies are
available and in correct versions.</p>
</div>
<div class="paragraph">
<p>Simplest use case without arguments queries all <code>requirements.txt</code> of current
package version in autodetected release/dist:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ rdopkg reqquery
Autodetected filter: kilo/f22
Querying requirements file from git: 1.0.3 -- requirements.txt

kilo/f22
  pbr
    nvr:   python-pbr-0.10.8-1.fc22
    need:  &gt;=0.6,!=0.7,&lt;1.0
    state: OK
  python-novaclient
    nvr:   python-novaclient-2.23.0-1.fc23
    need:  &gt;=2.18.0,!=2.21.0
    state: OK
  cliff-tablib
    nvr:   python-cliff-tablib not available
    need:  &gt;=1.0
    state: not met
...</pre>
</div>
</div>
<div class="paragraph">
<p>We can also select the release/dist filter manually (see <code>rdopkg info</code>):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ rdopkg reqquery kilo/el7</pre>
</div>
</div>
<div class="paragraph">
<p>By default, current version <code>requirements.txt</code> are used, but we can select
a different requirements source:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>git ref (version):</p>
<div class="literalblock">
<div class="content">
<pre>$ rdopkg reqquery -R 1.2.3</pre>
</div>
</div>
</li>
<li>
<p>file:</p>
<div class="literalblock">
<div class="content">
<pre>$ rdopkg reqquery -r path/to/requirements.txt</pre>
</div>
</div>
</li>
<li>
<p>from current <code>.spec</code> file:</p>
<div class="literalblock">
<div class="content">
<pre>$ rdopkg reqquery -s</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>As it usually takes quite some time to <code>repoquery</code> all the repos, we might
want to run with <code>-v</code>/<code>--verbose</code>, dump to <code>requirements.yml</code> with
<code>-d</code>/<code>--dump</code> and then view the report with <code>-l</code>/<code>--load</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ rdopkg reqquery -v -d
Autodetected filter: kilo/f22
Querying requirements file from git: 1.0.3 -- requirements.txt

repoquery --nvr --repofrompath=...
RDO Kilo f22: N/A
...

$ rdopkg reqquery -l</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_epilogue">EPILOGUE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See <code>rdopkg ACTION -h</code> to get options for each ACTION.</p>
</div>
<div class="paragraph">
<p>See <a href="rdopkg.1.html">rdopkg(1)</a> manual for more information.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-02-22 17:36:21 CET
</div>
</div>
</body>
</html>