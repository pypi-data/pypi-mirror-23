#!/usr/bin/python3
#
# Copyright (C) 2016,2017 by Bart Thate <bthate@dds.nl>
#
# Permission to use, copy, modify, and/or distribute this software for any
# purpose with or without fee is hereby granted.
# 
# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES 
# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF 
# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE 
# FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY 
# DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER
# IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT
# OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
#
# bot-docs - create botlib documentation
#
# 12-7-2017 Added to the Public Domain.

""" create documentation for botlib. """

import sys, os, shutil, importlib

importlib.invalidate_caches()

sys.path.insert(0, os.getcwd())
sys.path.insert(0, os.getcwd() + os.sep + '..')

projectname = "botlib"
source = os.getcwd()
print("source is %s" % source)
sys.path.insert(0, source)
docdir = os.path.join(source, "docs")
curdir = os.path.abspath(os.getcwd())
targetdir = os.path.join(curdir, "docs")

os.environ["SPHINX_APIDOC_OPTIONS"] = "noindex"
os.environ["SPHINX_AUTOGEN_OPTIONS"] = "noindex"
os.environ['PYTHONPATH'] = os.path.abspath(source)

import unittest

for line in os.popen("mkdir docs 2>&1").readlines():
    pass
for line in os.popen("rm -fR docs/html/").readlines():
    print(line.strip())
for line in os.popen("rm -fR docs/code/").readlines():
    print(line.strip())
for line in os.popen("rm -fR docs/botlib/").readlines():
    print(line.strip())
for line in os.popen("mkdir docs/html 2>&1").readlines():
    pass
for line in os.popen("mkdir docs/botlib 2>&1").readlines():
    print(line.strip())
for line in os.popen("sphinx-build -a %s %s/html" % (docdir, targetdir)).readlines():
    pass

zipname = "%s.html.zip" % projectname
os.chdir("%s/html" % targetdir)

for line in os.popen("zip -r %s.html.zip *" % projectname).readlines(): pass
for line in os.popen("mv %s.html.zip ../../" % projectname).readlines(): pass

os.chdir(os.getcwd())
