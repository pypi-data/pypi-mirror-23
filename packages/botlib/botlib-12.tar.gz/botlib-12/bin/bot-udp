#!/usr/bin/python3
#
# Copyright (C) 2016,2017 by Bart Thate <bthate@dds.nl>
#
# Permission to use, copy, modify, and/or distribute this software for any
# purpose with or without fee is hereby granted.
#
# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES 
# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF 
# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE 
# FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY 
# DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER
# IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT
# OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
#
# bot-udp - echo udp packets to a chat room
#
# 12-7-2017 Added to the Public Domain

""" udp client program. """

import os, sys, warnings
sys.path.insert(0, os.getcwd())

warnings.simplefilter("ignore", UserWarning)

from botlib.trace import get_exception
from botlib.utils import strip_html
from botlib.template import udp

import logging
import select
import socket

def out(txt):
    txt = strip_html(txt)
    data = '%s %s' % (udp.password, txt.strip())
    sock = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)
    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    sock.sendto(bytes(data, "utf-8"), (udp.host, udp.port))

def main():
    while 1:
        (i, o, e) = select.select([sys.stdin],[],[sys.stderr,])
        for sock in i + e:
            try:
                txt = sock.readline()
                out(txt)
            except:
                logging.error(get_exception())

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        pass
