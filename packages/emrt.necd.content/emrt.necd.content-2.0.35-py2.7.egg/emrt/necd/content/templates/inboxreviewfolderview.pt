<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="emrt.necd.content">
  <tal:block metal:fill-slot="javascript_head_slot">
    <script type="text/javascript">
      $(document).ready(function(){
        $(".observationText").text(function(index, currentText){
          if (currentText.length > 500){
            $(this).text(currentText.substr(0, 500) + "...");
            $(this).attr("title", currentText);
          }
        });
        $("#btnFilter").click(function(){
            var filter = "";
            if ($('#freeTextFilter').val() != ""){
              if (filter == ""){
                filter += "?";
              }else{
                filter += "&";
              }
              filter += "freeText=" + $('#freeTextFilter').val();
            }
            window.location.href = window.location.pathname + filter;
          })
        });
    </script>
  </tal:block>
<body>

  <metal:main fill-slot="content-core"
              tal:define="
                macro_template python:here.restrictedTraverse('@@macros');
                macro_observationlist python:macro_template['macros']['observationlist'];
                is_secretariat python:view.is_secretariat();
                is_se python:view.is_sector_expert();
                is_lr python:view.is_lead_reviewer();
                is_mse python:view.is_member_state_expert();
                is_msc python:view.is_member_state_coordinator()">
    <metal:content-core define-macro="content-core">

  <div id="inbox-view-content">
      <div class="actions" tal:condition="view/can_add_observation">
        <a href="./++add++Observation"
          tal:attributes="href string:${here/absolute_url}/++add++Observation"
          class="standardButton defaultWFButton">
            New observation
        </a>
      </div>
      <div id="tabs">
        <div class="tabs">
          <div>
            <a class="eea-icon overview" tal:attributes="href string:${here/absolute_url}/view">Overview list</a>
          </div>
          <div class="active">
            <a class="eea-icon inbox" tal:attributes="href string:${here/absolute_url}/inboxview">My view</a>
          </div>
          <div>
            <a class="eea-icon inbox" tal:attributes="href string:${here/absolute_url}/finalisedfolderview">Finalised observations</a>
          </div>
        </div>
      </div>

      <div id="filters">
        <div class="row" style="padding-top:30px">
          <div class="cell position-1 width-3 esdLabel">Free text</div>
        </div>
        <div class="row">
          <div class="cell position-1 width-12 esdLabel">
            <input type="text" id="freeTextFilter" style="width:100%;border-radius:5px;height:21px"
                tal:define="freeText python:'';
                            freeText request/freeText | freeText"
                tal:attributes="value python:freeText"/>
          </div>
          <div class="cell position-14 width-1">
            <a class="standardButton" id="btnFilter">Search</a>
          </div>
        </div>
      </div>

      <div id="observations" class="myview" tal:condition="not:here/@@plone_portal_state/anonymous">
        <!-- Sector Expert -->
        <tal:block tal:condition="python:is_secretariat or is_se">
          <div>
            <div class="collapsiblePanelTitle" data-panel="my-actions">
              <div>
                <tal:se condition="is_se">My actions</tal:se>
                <tal:secretariat condition="is_secretariat">Sector Expert actions</tal:secretariat>
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
          </div>
            <div class="my-actions inboxSection">
              <div class="collapsibleListTitle" data-list="draft-observations">
                <div>
                  Draft observations
                  <span class="eea-icon eea-icon-left"></span>
                </div>
              </div>
              <div class="draft-observations"
                tal:define="observations view/get_draft_observations; idx string:1">
                <metal:obslist use-macro="macro_observationlist" />
              </div>
          </div>
          <div class="my-actions inboxSection">
            <div class="collapsibleListTitle" data-list="draft-questions">
              <div>
                Draft questions
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="draft-questions"
                 tal:define="observations view/get_draft_questions; idx python:2">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div class="my-actions inboxSection">
            <div class="collapsibleListTitle" data-list="counterpart-questions-to-comment">
              <div>
                Counterpart questions to comment
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="counterpart-questions-to-comment"
                 tal:define="observations view/get_counterpart_questions_to_comment; idx python:3">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div class="my-actions inboxSection">
            <div class="collapsibleListTitle" data-list="counterpart-conclusions-to-comment">
              <div>
                Counterpart conclusions to comment
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="counterpart-conclusions-to-comment"
                 tal:define="observations view/get_counterpart_conclusion_to_comment; idx python:4">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div class="my-actions inboxSection">
            <div class="collapsibleListTitle" data-list="ms-answers-to-review">
              <div>
                MS answers to review
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="ms-answers-to-review"
                 tal:define="observations view/get_ms_answers_to_review; idx python:5">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div class="my-actions inboxSection">
            <div class="collapsibleListTitle" data-list="draft-questions">
              <div>
                Conclusion denied
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="draft-questions"
                 tal:define="observations view/get_denied_observations; idx python:60">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div>
            <div class="collapsiblePanelTitle" data-panel="other-actions-for-my-observations">
              <div>
                <tal:se condition="is_se">Other actions for my observations</tal:se>
                <tal:secretariat condition="is_secretariat">Other Sector Expert actions</tal:secretariat>
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
          </div>

          <div class="other-actions-for-my-observations inboxSection">
            <div class="collapsibleListTitle" data-list="approval-questions">
              <div>
                Observations for approval
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="other-actions-for-my-observations approval-questions"
                 tal:define="observations view/get_approval_questions; idx python:6">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>

          <div class="other-actions-for-my-observations inboxSection">
            <div class="collapsibleListTitle" data-list="unanswered-questions">
              <div>
                Unanswered questions
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="other-actions-for-my-observations unanswered-questions"
                 tal:define="observations view/get_unanswered_questions; idx python:7">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div class="other-actions-for-my-observations inboxSection">
            <div class="collapsibleListTitle" data-list="waiting-for-comment-from-counterparts-for-question">
              <div>
                Waiting for comment from counterparts for question
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="other-actions-for-my-observations waiting-for-comment-from-counterparts-for-question"
                 tal:define="observations view/get_waiting_for_comment_from_counterparts_for_question; idx python:8">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div class="other-actions-for-my-observations inboxSection">
            <div class="collapsibleListTitle" data-list="waiting-for-comment-from-counterparts-for-conclusion">
              <div>
                Waiting for comment from counterparts for conclusion
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="other-actions-for-my-observations waiting-for-comment-from-counterparts-for-conclusion"
                 tal:define="observations view/get_waiting_for_comment_from_counterparts_for_conclusion; idx python:9">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div class="other-actions-for-my-observations inboxSection">
            <div class="collapsibleListTitle" data-list="observation-for-finalisation">
              <div>
                Observation for finalisation
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="other-actions-for-my-observations observation-for-finalisation"
                 tal:define="observations view/get_observation_for_finalisation; idx python:10">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
        </tal:block>
        <!-- Lead Reviewer -->
        <tal:block tal:condition="python:is_secretariat or is_lr">
          <div>
            <div class="collapsiblePanelTitle" data-panel="my-actions">
              <div>
                <tal:lr condition="is_lr">My actions</tal:lr>
                <tal:secretariat condition="is_secretariat">Lead Reviewer actions</tal:secretariat>
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
          </div>
          <div class="my-actions inboxSection">
            <div class="collapsibleListTitle" data-list="questions-to-be-sent">
              <div>
                Questions to be sent
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="my-actions questions-to-be-sent"
                 tal:define="observations view/get_questions_to_be_sent; idx python:11">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div class="my-actions inboxSection">
            <div class="collapsibleListTitle" data-list="observations-to-finalise">
              <div>
                Observations to finalise
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="my-actions observations-to-finalise"
                 tal:define="observations view/get_observations_to_finalise; idx python:12">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div class="my-actions inboxSection">
            <div class="collapsibleListTitle" data-list="questions-to-comment">
              <div>
                Questions to comment
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="my-actions questions-to-comment"
                 tal:define="observations view/get_questions_to_comment; idx python:13">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div class="my-actions inboxSection">
            <div class="collapsibleListTitle" data-list="conclusions-to-comment">
              <div>
                Conclusions to comment
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="my-actions conclusions-to-comment"
                 tal:define="observations view/get_conclusions_to_comment; idx python:14">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div>
            <div class="collapsiblePanelTitle" data-panel="my-teams-actions">
              <div>
                <tal:lr condition="is_lr">My team's actions</tal:lr>
                <tal:secretariat condition="is_secretariat">Lead Reviewer's team actions</tal:secretariat>
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
          </div>
          <div class="my-teams-actions inboxSection">
            <div class="collapsibleListTitle" data-list="questions-with-comments-from-reviewers">
              <div>
                Questions with comments from reviewers
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="my-teams-actions questions-with-comments-from-reviewers"
                 tal:define="observations view/get_questions_with_comments_from_reviewers; idx python:15">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div class="my-teams-actions inboxSection">
            <div class="collapsibleListTitle" data-list="answers-from-ms">
              <div>
                Answers from MS
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="my-teams-actions answers-from-ms"
                 tal:define="observations view/get_answers_from_ms; idx python:16">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div>
            <div class="collapsiblePanelTitle" data-panel="my-ms-actions">
              <div>
                <tal:lr condition="is_lr">My MS' actions</tal:lr>
                <tal:secretariat condition="is_secretariat">Lead Reviewer's MS' actions</tal:secretariat>
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
          </div>
          <div class="my-ms-actions inboxSection">
            <div class="collapsibleListTitle" data-list="unanswered-questions-lr-que">
              <div>
                Unanswered questions
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="my-ms-actions unanswered-questions-lr-que"
                 tal:define="observations view/get_unanswered_questions_lr; idx python:17">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
        </tal:block>
        <!-- MS Coordinator -->
        <tal:block tal:condition="python:is_secretariat or is_msc">
          <div>
            <div class="collapsiblePanelTitle" data-panel="my-actions">
              <div>
                <tal:msc condition="is_msc">My actions</tal:msc>
                <tal:secretariat condition="is_secretariat">MS Coordinator actions</tal:secretariat>
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
          </div>
          <div class="my-actions inboxSection">
            <div class="collapsibleListTitle" data-list="questions-to-be-answered">
              <div>
                Questions from Sector Expert to be answered
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="my-actions questions-to-be-answered"
                 tal:define="observations view/get_questions_to_be_answered; idx python:18">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div class="my-actions inboxSection">
            <div class="collapsibleListTitle" data-list="questions-with-comments-received-from-mse">
              <div>
                Comments received from MS experts
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="my-actions questions-with-comments-received-from-mse"
                 tal:define="observations view/get_questions_with_comments_received_from_mse; idx python:19">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div>
            <div class="collapsiblePanelTitle" data-panel="mse-actions">
              <div>
                MS experts actions
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
          </div>
          <div class="mse-actions inboxSection">
            <div class="collapsibleListTitle" data-list="answers-requiring-comments-from-mse">
              <div>
                Answers requiring comments/discussion from MS experts
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="mse-actions answers-requiring-comments-from-mse"
                 tal:define="observations view/get_answers_requiring_comments_from_mse; idx python:20">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div>
            <div class="collapsiblePanelTitle" data-panel="se-re-actions">
              <div>
                Sector Expert actions
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
          </div>
          <div class="se-re-actions inboxSection">
            <div class="collapsibleListTitle" data-list="answers-sent-to-se-re">
              <div>
                Answers sent to Sector Expert
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="se-re-actions answers-sent-to-se-re"
                 tal:define="observations view/get_answers_sent_to_se_re; idx python:21">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
        </tal:block>
        <!-- MS Expert -->
        <tal:block tal:condition="python:is_secretariat or is_mse">
          <div>
            <div class="collapsiblePanelTitle" data-panel="my-actions">
              <div>
                <tal:mse condition="is_mse">My actions</tal:mse>
                <tal:secretariat condition="is_secretariat">MS Expert actions</tal:secretariat>
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
          </div>
          <div class="my-actions inboxSection">
            <div class="collapsibleListTitle" data-list="questions-with-comments-for-answer-needed-by-msc">
              <div>
                Comments for answer needed by MS coordinator
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="my-actions questions-with-comments-for-answer-needed-by-msc"
                 tal:define="observations view/get_questions_with_comments_for_answer_needed_by_msc; idx python:22">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div>
            <div class="collapsiblePanelTitle" data-panel="msc-actions">
              <div>
                MSC actions
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
          </div>
          <div class="msc-actions inboxSection">
            <div class="collapsibleListTitle" data-list="observations-with-my-comments">
              <div>
                Observations with my comments still with MSC
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="msc-actions observations-with-my-comments"
                 tal:define="observations view/get_observations_with_my_comments; idx python:23">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
          <div>
            <div class="collapsiblePanelTitle" data-panel="sr-re-actions">
              <div>
                Sector Expert actions
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
          </div>
          <div class="sr-re-actions inboxSection">
            <div class="collapsibleListTitle" data-list="observations-with-my-comments-sent-to-se-re">
              <div>
                Answers that I commented on sent to Sector Expert
                <span class="eea-icon eea-icon-left"></span>
              </div>
            </div>
            <div class="sr-re-actions observations-with-my-comments-sent-to-se-re"
                 tal:define="observations view/get_observations_with_my_comments_sent_to_se_re; idx python:24">
              <metal:obslist use-macro="macro_observationlist" />
            </div>
          </div>
        </tal:block>
      </div>

</div>
</metal:content-core>
</metal:main>
</body>
</html>
